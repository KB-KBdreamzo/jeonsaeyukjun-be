<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jeonsaeyukjun.jeonsaeyukjunbe.mypage.mapper.MypageMapper">

    <select id="getReports" resultType="ReportDto">
        SELECT * FROM report WHERE user_id = #{userId} and is_delete = false;
    </select>

    <select id="getLimitReports" resultType="ReportDto">
        SELECT * FROM report WHERE user_id = #{userId} and is_delete = false ORDER BY create_at DESC LIMIT #{limit};
    </select>

    <!-- 특정 사용자의 보고서 목록을 페이지네이션을 통해 가져오기 -->
    <select id="getReportsWithPaging" resultType="ReportDto" parameterType="map">
        SELECT * FROM report
        WHERE user_id = #{userId}
          AND is_delete = false
        <if test="query != null and query != ''">
            AND (road_name LIKE CONCAT('%', #{query}, '%') OR detail_address LIKE CONCAT('%', #{query}, '%'))
        </if>
        ORDER BY
        <choose>
            <when test="sortKey=='oldest'">create_at ASC</when>
            <when test="sortKey=='lastest'">create_at DESC</when>
        </choose>
        LIMIT #{size} OFFSET #{offset};
    </select>

    <!-- 전체 보고서 개수 조회 -->
    <select id="getTotalReportCount" resultType="int">
        SELECT COUNT(*) FROM report
        WHERE user_id = #{userId}
        <if test="query != null and query != ''">
            AND (road_name LIKE CONCAT('%', #{query}, '%') OR detail_address LIKE CONCAT('%', #{query}, '%'))
        </if>
          AND is_delete = false;
    </select>

</mapper>
